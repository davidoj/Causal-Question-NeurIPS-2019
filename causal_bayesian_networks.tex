\section{Causal Bayesian Networks}

A Causal Bayesian Network (CBN) is a directed acyclic graph (DAG) $\mathcal{G}$ containing a set of nodes $\{\RV{X}^i\}_{i\in[N]}$ which we identify with random variables on some space $(E,\mathcal{E})$. Given a decision $y\in D$ (called a \emph{do-intervention} in other treatments) and a distribution $\mu\in \Delta(\mathcal{E})$ that is \emph{compatible} (Definition \ref{def:compat}) with $\mathcal{G}$, $\mathcal{G}$ induces an \emph{interventional} distribution $\mu^{\mathcal{G},y}$. The set of pairs $(\mu,y\mapsto \mu^{\mathcal{G},y})$ for $\mu$ compatible with $\mathcal{G}$ is a causal theory $\mathscr{T}_{\mathcal{G}}$.

In all following discussion, we assume the observed data represented by $\RV{X}$ is a sequence of independent and identically distributed random variables $\RV{X}=(\RV{X}_t)_{t\in T}$. We identify distributions over the sequence $\RV{X}$ with distributions over the initial observation $\RV{X}_0$ and subsequently drop the subscript.

The CBN convention is to denote an interventional distribution with $\mu(\cdot|do(\RV{X}^i=a))$. Here we associate every allowable set of $do$ statements with an element of the decision space $(D,\mathcal{D})$ equipped with random variables $\{\RV{D}^i\}_{i\in[N]}$ such that for $y\in D$, $\mu^y(\cdot) := P(\cdot|[do(\RV{X}^j=\RV{D}^i(y))]_{i\in N})$. The special element $*$ corresponds to a passive intervention which is denoted by the absence of a $do()$ statement in regular CBN notation.

\begin{definition}[Compatibility]\label{def:compat}
Given a DAG $\mathcal{G}$, $d$-separation is a ternary relation amongst sets of nodes the details for which we refer readers to \cite{pearl_causality:_2009}. For a set of nodes $\{\RV{X}^i\}_{i\in[N]}$ we write $\RV{X}^i\perp_{\mathcal{G}} \RV{X}^j | \mathbf{X}$ to say $\RV{X}^i$ is d-separated in $\mathcal{G}$ from $\RV{X}^j$ by $\mathbf{X}\subset \{\RV{X}^i\}_{[N]}$.

Given a measurable space $(E,\mathcal{E})$, $\mu\in \Delta(\mathcal{E})$ and a set of random variables $\{\RV{X}^i\}_{i\in[N]}$ on $E$, $\RV{X}^i$ is independent of $\RV{X}^j$ conditional on $\mathbf{X}$ if $\mu_{\mathbf{X}} \splitter{0.13}(F_{\RV{X}^i}\otimes F_{\RV{X}^j}) = \mu_{\mathbf{X}} F_{\RV{X}^i} \mu_{\mathbf{X}}F_{\RV{X}^j}$, $\mu$-almost surely. This is written $\RV{X}^i\CI_\mu \RV{X}^j|\mathbf{X}$.

$\mu$ is compatible with $\mathcal{G}$ if $\RV{X}^i\perp_{\mathcal{G}} \RV{X}^j | \mathbf{X} \implies \RV{X}^i\CI_\mu \RV{X}^j|\mathbf{X}$
\end{definition}

\begin{definition}[Causal Bayesian Network]\label{def:CBN}
\todo{A CBN has a graph $\mathcal{G}$ with edges $\{V^i\}_{[N]}$, random variables $\{\RV{X}^i\}_{[N]}$ and decision variables $\{\RV{D}^i\}_{[N]}$ which are all associated with one another in the obvious way. It would be nice to have a simple way of expressing this bundle of things and the corresponding associations}

Consider a directed acyclic graph $\mathcal{G}$ with nodes $\mathbf{X}=\{\RV{X}^i|i\in [N]\}$, a measurable space $(E,\mathcal{E})$ and a set of random variables $\RV{X}^i:E\to X^i$ and $X=\times_{i\in[N]} X^i$ along with decision space $(D,\mathcal{D})$ and random variables $\{\RV{D}^i\}_{i\in [N]}$ where $\RV{D}^i:D\to X^i\cup\{*\}$.

Given any $y\in D$ let $S(y)\subset[N]$ be the set of all indices $i$ such that $\RV{D}^i(y)\neq *$. Let $\mathscr{H}_\mathcal{G}\subset\Delta(\mathcal{X})$ be the set of distributions compatible with $\mathcal{G}$. Given arbitrary $\mu\in \mathscr{H}_\mathcal{G}$ and $y\in D$ the $\mathcal{G},\mu,y$-interventional distribution denoted $\mu^{\mathcal{G},y}$ is given by the following three conditions:
\begin{enumerate}
    \item $\mu^{\mathcal{G},y}$ is compatible with $\mathcal{G}$
    \item For all $i\in S(y)$, $\mu^{\mathcal{G},y}F_{\RV{X}^i}=\delta_{\RV{D}^i(y)} F_{\RV{X}^i}$
    \item For all $i\not \in S(y)$, $\mu^{\mathcal{G},y}_{\PA{\mathcal{G}}{\RV{X}^i}} F_{\RV{X}^i}=\mu_{\PA{\mathcal{G}}{\RV{X}^i}}F_{\RV{X}^i} $, $\mu^{\mathcal{G},y}$-almost surely
\end{enumerate}
\end{definition}

$\PA{\mathcal{G}}{\RV{X}^i}$ are the parents of $\RV{X}^i$ with respect to the graph $\mathcal{G}$ and $\mu_{\PA{\mathcal{G}}{\RV{X}^i}}$ is the conditional probability with respect to $\mu$ and the $\sigma$-algebra generated by the set $\PA{\mathcal{G}}{\RV{X}^i}$. Recall that $\mu \splitter{0.15}(\otimes_{i\not\in S(y)} F_{\RV{X}^i})$ is the joint distribution of $\{\RV{X}^i|i\in S(y)\}$.

To establish that the map $\kappa^{\mathcal{G},\mu}:D\to \Delta(\mathcal{X})$ given by $y\mapsto \mu^{\mathcal{G},y}$ is a consequence map, we must shown that it is measurable with respect to the $\sigma$-algebra generated by the set of variables $\RV{D}^i$; this is shown by Theorem \ref{th:cbn_MK} provided in Appendix \ref{app:cbn_ct}. Defining $\mathscr{H}_{\mathcal{G}}\subset\Delta(\mathcal{X})$ to be the set of distributions compatible with $\mathcal{G}$, the set of pairs $\{(\mu, \kappa^\mu)|\mu\in \mathscr{H}_{\mathcal{G}}\}$ is the causal theory $\mathscr{T}_\mathcal{G}$.

\paragraph*{Extending the theory induced by a CBN} The causal theory $T_{\mathcal{G}}$ defined above associates a consequence with every probability distribution compatible with $\mathcal{G}$ but not every probability distribution in $\Delta(\mathcal{X})$. It is arguably not reasonable to assume \emph{a priori} that the conditional independences implied by $\mathcal{G}$ hold in the observed data. We might therefore regard the theory $\mathscr{T}_{\mathcal{G}}$ to be incomplete, and seek some extension of the theory for distributions not in $\mathcal{H}_{\mathcal{G}}$.

\begin{example}[Extension of a CBN]\label{ex:extn_cbn}

Consider the graph $\mathcal{G}=$\begin{tikzpicture}[baseline=-1.5mm,-latex]
\node (C) {$C$};
\node [right of = C] (A) {$A$};
\node [right of = A] (B) {$B$};
\draw (C) -- (A);
\draw (A) -- (B);
\end{tikzpicture}, which implies a single conditional independence: $\RV{C}\CI \RV{B}|\RV{A}$.

Suppose the three associated random variables $\RV{A}$, $\RV{B}$ and $\RV{C}$ each take values in $\{0,1\}$ and suppose (unrealistically) we know all $\mu$ in the set of possible joint distributions $\mathscr{H}$ share the marginal distribution $\mu F_{\RV{B}} := \zeta$ and the conditional distribution $\mu_{\{\RV{A}\}} F_{\RV{B}} = \iota$ and $\RV{C}$ is ``almost'' independent of $\RV{B}$ given $\RV{A}$:
\begin{align}
    \max_{x\in\{0,1\}^3,y\in\{0,1\}}\left|\mu_{\{\RV{A},\RV{C}\}} F_{\RV{B}}(x;\{y\}) - \iota(x;\{y\}) \right| &< \epsilon \label{eq:app_ci}
\end{align}

Suppose that only interventions on $\RV{A}$ are possible and the problem supplies a generalised utility such that, overloading $\RV{B}$, $U(\xi)=\mathbb{E}_{\xi}[\RV{B}]$. For convenience, we restrict our attention to the subset of decisions $D'=\{y|\RV{D}_\RV{B}(y)=\RV{D}_\RV{C}(y)=*\}$ and consequence maps marginalised over $\RV{A}$ and $\RV{C}$. Define $\kappa^{\mathcal{G}}$ by
\begin{align}
    \kappa^{\mathcal{G}}(y;Z) := \begin{cases} \iota(\RV{D}_A(y);Z) & \RV{D}_\RV{A}(y) \neq *\\
                                              \zeta(Z) & \RV{D}_\RV{A}(y) = *\end{cases}
\end{align}

It can be verified that the causal theory $\mathscr{T}_{\mathcal{G}}$ induced by $\mathcal{G}$ and the set of compatible distributions $\mathscr{H}_\mathcal{G}\subset\mathscr{H}$ is the set of pairs $\{(\nu,\kappa^{\mathcal{G}} )|\nu\in \mathscr{H}_{\mathcal{G}}\}$.

Consider two options for extending this to distributions $\nu\in \mathscr{H}$ but not in $\mathscr{H}_{\mathcal{G}}$, noting that one could imagine many possibilities: $\mathscr{T}_{\mathcal{G}}^\subset$ is the union of causal theories given by all graphs $\mathcal{G}'$ on $\{A, B, C\}$ such that $\mathcal{G}\subset \mathcal{G}'$ (in this case, just $\mathcal{G}$ and \begin{tikzpicture}[baseline=-1.5mm,-latex]
\node (C) {$C$};
\node [right of = C] (A) {$A$};
\node [right of = A] (B) {$B$};
\draw (C) -- (A);
\draw (A) -- (B);
\draw (C) to [bend left] (B);
\end{tikzpicture}), and  $\mathscr{T}_{\mathcal{G}}^\circ$ is the union of causal theories given by the all DAGs on the set of nodes $\{\RV{A}, \RV{B}, \RV{C}\}$.

The theory $\mathscr{T}_{\mathcal{G}}^\subset$ is given by $\mathscr{T}_{\mathcal{G}}\cup\{(\nu,\eta^\nu )|\nu \in \mathscr{H}\setminus\mathscr{H}_\mathcal{G}\}$ where 
\begin{align}
    \eta^\nu:=\begin{cases}(y;Z)\mapsto \sum_{c\in\{0,1\}} \nu F_{\RV{C}}(\{c\}) \nu_{\{\RV{A},\RV{C}\}} F_{\RV{B}}(\RV{D}_A(y),c;Z) &\RV{D}_A(y)\neq *\\
    \zeta(Z) &\RV{D}_A(y)=*\end{cases}
\end{align}

$\mathscr{T}_{\mathcal{G}}^\circ$ is the set of states associated with three types of graph: those featuring no arrow \begin{tikzpicture}[baseline=-1.5mm,-latex]
\node (A) {$A$};
\node [right of = A] (B) {$B$};
\draw (A) -- node[strike out,draw,-]{} (B);
\end{tikzpicture}, those featuring \begin{tikzpicture}[baseline=-1.5mm,-latex]
\node  (A) {$A$};
\node [right of = A] (B) {$B$};
\draw (A) -- (B);
\end{tikzpicture} but not \begin{tikzpicture}[baseline=-1.5mm,-latex]
\node  (C) {$C$};
\node [right of = C] (B) {$B$};
\draw (C) -- (B);
\end{tikzpicture} and \begin{tikzpicture}[baseline=-1.5mm,-latex]
\node  (C) {$C$};
\node [right of = C] (A) {$A$};
\draw (C) -- (A);
\end{tikzpicture} and the graph \begin{tikzpicture}[baseline=-1.5mm,-latex]
\node (C) {$C$};
\node [right of = C] (A) {$A$};
\node [right of = A] (B) {$B$};
\draw (C) -- (A);
\draw (A) -- (B);
\draw (C) to [bend left] (B);
\end{tikzpicture}. These possibilities yield $\mathscr{T}_{\mathcal{G}}^\circ=\mathscr{T}_{\mathcal{G}}^\subset\cup\{(\nu,y\mapsto \zeta)|\nu \in \mathscr{H}\setminus\mathscr{H}_\mathcal{G}\}$.

By \ref{eq:app_ci}, $|\eta(x;\{y\})-\iota(x;\{y\})|<\epsilon$ for all $x\in A\cup\{*\}$ and $y\in B$ and therefore for $J\in \mathscr{J}$, $|U(\mu J\splitter{0.1} (I_D\otimes \eta)) - U(\mu J\splitter{0.1} (I_D\otimes \iota))|<\epsilon$. Therefore a small $\epsilon$ ensures $\mathscr{T}^\subset_{\mathcal{G}}$ yields a risk set ``close'' to the risk given by $\mathscr{T}_{\mathcal{G}}$ for any $J$. On the other hand, $|\iota(x;\{y\})-\zeta(\{y\})|$ is independent of $\epsilon$, so $\mathscr{T}^\circ_{\mathcal{G}}$ yields a risk set that contains points that do not converge to the risk set induced by $\mathscr{T}_{\mathcal{G}}$ with small $\epsilon$.
\end{example}

Extensions of the ``base theory'' $\mathscr{T}_{\mathcal{G}}$ can yield very different risk sets even when the departure from compatibility is slight and we limit those extensions to being based on CBNs. This example is complementary to results indicating that with unknown variable ordering (which may be regarded as analogous to $\mathscr{T}_{\mathcal{G}}^\circ$) or with unmeasured confounders it is not possible to construct a test that uniformly converges to the true graph equivalence class \citep{robins_uniform_2003,zhang_strong_2003}; our example shows that some misses may be benign and others may not. We will finally note that the more general theory $\mathscr{T}^\circ_{\mathcal{G}}$ still has a nontrivial risk set, and hence (potentially) nontrivial implications for decision making. We think that the investigation of risk sets for ``extended theories'' discussed here or graph learning algorithms considered in the CBN literature presents many interesting questions.